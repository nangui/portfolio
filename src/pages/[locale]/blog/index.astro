---
import BlogLayout from '@layouts/BlogLayout.astro';
import BlogCard from '@components/blog/BlogCard.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import { isValidLocale, defaultLocale } from '@i18n/config';
import { getTranslation } from '@i18n/translations';

export async function getStaticPaths() {
  return [
    { params: { locale: 'fr' } },
    { params: { locale: 'en' } },
  ];
}

interface Props {
  locale: string;
}

const { locale: localeParam } = Astro.params;
const locale = isValidLocale(localeParam || '') ? localeParam as 'fr' | 'en' : defaultLocale;

const blogPosts = (await getCollection('blog'))
  .sort((a: CollectionEntry<'blog'>, b: CollectionEntry<'blog'>) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const title = getTranslation('blog', 'title', locale);
const description = getTranslation('blog', 'description', locale);
---

<BlogLayout 
  title={`${title} - Adonai Nangui`}
  description={description}
  locale={locale}
>
  <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <header class="mb-12">
      <h1 class="font-heading font-semibold text-4xl md:text-5xl mb-4 text-primary">
        {title}
      </h1>
      <p class="text-lg text-secondary">
        {description}
      </p>
    </header>

    <section class="space-y-8">
      {blogPosts.map((post: CollectionEntry<'blog'>) => (
        <BlogCard entry={post} locale={locale} />
      ))}
    </section>

    {blogPosts.length === 0 && (
      <p class="text-center text-secondary py-12">
        {getTranslation('blog', 'noPosts', locale)}
      </p>
    )}
  </main>
</BlogLayout>
