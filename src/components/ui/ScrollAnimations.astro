---
// ScrollTrigger animations for page sections
// Fade in sections as they enter viewport
---

<script>
  import('gsap').then(({ gsap }) => {
    return import('gsap/ScrollTrigger').then(({ default: ScrollTrigger }) => {
      gsap.registerPlugin(ScrollTrigger);
      
      // Animate sections on scroll
      const sections = document.querySelectorAll('section[id]');
      
      sections.forEach((section) => {
        gsap.fromTo(section,
          {
            opacity: 0,
            y: 50,
          },
          {
            opacity: 1,
            y: 0,
            duration: 1,
            ease: 'power2.out',
            scrollTrigger: {
              trigger: section,
              start: 'top 85%', // Start animation when top of section hits 85% of viewport
              end: 'top 50%',
              toggleActions: 'play none none reverse',
              once: false, // Allow reverse animation on scroll up
            }
          }
        );
      });
      
      // Pause/resume animations based on page visibility
      const handleVisibilityChange = () => {
        if (document.hidden) {
          gsap.globalTimeline.pause();
          ScrollTrigger.getAll().forEach(trigger => trigger.disable());
        } else {
          gsap.globalTimeline.resume();
          ScrollTrigger.getAll().forEach(trigger => trigger.enable());
        }
      };

      document.addEventListener('visibilitychange', handleVisibilityChange);

      // Cleanup on page unload
      window.addEventListener('beforeunload', () => {
        document.removeEventListener('visibilitychange', handleVisibilityChange);
        ScrollTrigger.getAll().forEach(trigger => trigger.kill());
      });
    }).catch((error) => {
      console.error('Failed to load ScrollTrigger:', error);
    });
  }).catch((error) => {
    console.error('Failed to load GSAP:', error);
  });
</script>
