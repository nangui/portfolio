---
import type { CollectionEntry } from 'astro:content';
import { defaultLocale, type Locale } from '@i18n/config';
import { formatPath } from '@i18n/utils';

interface Props {
  previous?: CollectionEntry<'blog'> | null;
  next?: CollectionEntry<'blog'> | null;
  locale?: Locale;
}

const { previous, next, locale = defaultLocale } = Astro.props;

// Helper function to get slug from entry
const getSlug = (entry: CollectionEntry<'blog'>): string => {
  if (entry.data.slug) return entry.data.slug;
  const filename = entry.id.split('/').pop() || entry.id;
  return filename.replace(/\.(md|mdx)$/, '');
};

const prevLabel = locale === 'fr' ? 'Article précédent' : 'Previous Article';
const nextLabel = locale === 'fr' ? 'Article suivant' : 'Next Article';
---

{(previous || next) && (
  <nav class="blog-navigation mt-12 pt-8 border-t border-border-default" aria-label="Navigation entre articles">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Article précédent -->
      {previous ? (
        <a 
          href={formatPath(`/blog/${getSlug(previous)}`, locale)}
          class="group flex flex-col gap-2 p-4 bg-secondary/30 border border-border-default rounded-lg hover:bg-secondary hover:border-accent transition-all"
        >
          <div class="flex items-center gap-2 text-xs text-secondary/60 uppercase tracking-wide">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            <span>{prevLabel}</span>
          </div>
          <h3 class="font-heading font-semibold text-lg text-primary group-hover:text-accent transition-colors line-clamp-2">
            {previous.data.title}
          </h3>
          {previous.data.description && (
            <p class="text-sm text-secondary line-clamp-2">
              {previous.data.description}
            </p>
          )}
        </a>
      ) : (
        <div class="p-4"></div>
      )}

      <!-- Article suivant -->
      {next ? (
        <a 
          href={formatPath(`/blog/${getSlug(next)}`, locale)}
          class="group flex flex-col gap-2 p-4 bg-secondary/30 border border-border-default rounded-lg hover:bg-secondary hover:border-accent transition-all text-right md:text-left"
        >
          <div class="flex items-center gap-2 text-xs text-secondary/60 uppercase tracking-wide justify-end md:justify-start">
            <span>{nextLabel}</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </div>
          <h3 class="font-heading font-semibold text-lg text-primary group-hover:text-accent transition-colors line-clamp-2">
            {next.data.title}
          </h3>
          {next.data.description && (
            <p class="text-sm text-secondary line-clamp-2">
              {next.data.description}
            </p>
          )}
        </a>
      ) : (
        <div class="p-4"></div>
      )}
    </div>
  </nav>
)}

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
