---
import type { CollectionEntry } from 'astro:content';
import { defaultLocale, type Locale } from '@i18n/config';
import { formatPath } from '@i18n/utils';

interface Props {
  entry: CollectionEntry<'blog'>;
  locale?: Locale;
}

const { entry, locale = defaultLocale } = Astro.props;
const { title, description, pubDate, tags } = entry.data;

// Get slug from id (filename without extension) or slug property
// With glob loader, id contains the file path relative to base
const getSlug = (entry: CollectionEntry<'blog'>): string => {
  if (entry.data.slug) return entry.data.slug;
  // Extract filename from id and remove extension
  const filename = entry.id.split('/').pop() || entry.id;
  return filename.replace(/\.(md|mdx)$/, '');
};
const slug = getSlug(entry);

// Format date based on locale
const dateLocale = locale === 'fr' ? 'fr-FR' : 'en-US';
---

<article class="border-b border-border-default pb-8 last:border-0">
  <a 
    href={formatPath(`/blog/${slug}`, locale)}
    class="block hover:opacity-80 transition-opacity"
  >
    <h2 class="font-heading font-semibold text-2xl mb-2 hover:text-accent text-primary">
      {title}
    </h2>
    
    {description && (
      <p class="text-secondary mb-4 line-clamp-2">
        {description}
      </p>
    )}
    
    <div class="flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4 text-sm text-secondary">
      <time datetime={pubDate.toISOString()} class="shrink-0">
        {pubDate.toLocaleDateString(dateLocale, { 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
        })}
      </time>
      
      {tags && tags.length > 0 && (
        <div class="flex flex-wrap gap-2">
          {tags.map((tag: string) => (
            <span class="px-2 py-1 bg-secondary/50 border border-border-default rounded-full text-xs whitespace-nowrap">
              {tag}
            </span>
          ))}
        </div>
      )}
    </div>
  </a>
</article>
